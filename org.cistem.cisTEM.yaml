app-id: org.cistem.cistem
runtime: org.freedesktop.Platform
runtime-version: "23.08"
sdk: org.freedesktop.Sdk
cleanup:
  - /include
  - /lib/*.a
  - /lib/*.la
  - /lib/pkgconfig
finish-args:
  - --filesystem=home
  - --share=ipc
  - --device=dri
  - --socket=wayland
  - --socket=fallback-x11
  - --share=network

modules:
  # - name: fftw
  #   buildsystem: autotools
  #   config-opts:
  #     - --enable-shared
  #     - --enable-float
  #     - --disable-static
  #   sources:
  #     - type: archive
  #       url: https://fftw.org/fftw-3.3.10.tar.gz
  #       sha256: 56c932549852cddcfafdab3820b0200c7742675be92179e59e6215b340e26467
  #     - type: shell
  #       commands:
  #         - cp /usr/share/gnu-config/config.sub .
  #         - cp /usr/share/gnu-config/config.guess .

  # - name: glu
  #   buildsystem: meson
  #   config-opts: 
  #     - -Dgl_provider=gl
  #   sources:
  #     - type: archive
  #       url: https://archive.mesa3d.org/glu/glu-9.0.3.tar.xz
  #       sha256: bd43fe12f374b1192eb15fe20e45ff456b9bc26ab57f0eee919f96ca0f8a330f
  #   cleanup: 
  #     - /include
  #     - /lib/*.a
  #     - /lib/*.la
  #     - /lib/pkgconfig

  - shared-modules/linux-audio/fftw3f.json  
  - shared-modules/glu/glu-9.json

  - name: wxWidgets
    buildsystem: autotools
    config-opts:
      - --enable-clipboard
      - --enable-controls
      - --enable-dataviewctrl
      - --enable-display
      - --enable-dnd
      - --enable-graphics_ctx
      - --enable-std_string
      - --enable-svg
      - --enable-unicode
      - --enable-webviewwebkit
      - --with-expat
      - --with-libjpeg
      - --with-libpng
      - --with-libtiff
      - --with-opengl
      - --with-zlib
      - --disable-dependency-tracking
      - --disable-tests
      - --disable-precomp-headers
      - --disable-monolithic
    sources:
      - type: git
        url: https://github.com/wxWidgets/wxWidgets.git
        tag: v3.0.2

  - name: cistem
    buildsystem: autotools
    post-install:
      - install -Dm644 ${FLATPAK_ID}.svg ${FLATPAK_DEST}/share/icons/hicolor/scalable/apps/${FLATPAK_ID}.svg
      - install -Dm644 ${FLATPAK_ID}.desktop ${FLATPAK_DEST}/share/applications/${FLATPAK_ID}.desktop
      - install -Dm644 ${FLATPAK_ID}.metainfo.xml ${FLATPAK_DEST}/share/metainfo/${FLATPAK_ID}.metainfo.xml
    sources:
      - type: archive
        url: https://grigoriefflab.umassmed.edu/sites/default/files/cistem-1.0.0-beta-source-code.tar.gz
        sha256: c62068f53d0a269ffa1bfff34641597d3795989a930686437fba9eed7a991af6
      # To avoid wxWidgets version check quirk
      - type: patch
        path: configure.patch
      - type: file
        path: org.cistem.cistem.svg
      - type: file
        path: org.cistem.cistem.desktop
      - type: file
        path: org.cistem.cistem.metainfo.xml
